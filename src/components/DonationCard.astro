---
const {
  id = `donation-${Math.random().toString(36).slice(2,8)}`,
  title = "Engangsdonation",
  subtitle = "St√∏t vores arbejde med et valgfrit bel√∏b.",
  accent = "pink", // "pink" eller "beigepink"
  amounts = [25, 50, 100],
  flow = ["amount","info","method","payment","terms","thankyou"],
} = Astro.props;

const ACCENT_HEX: Record<string,string> = {
  pink: "#ec4899",       // beigepink-400
  beigepink: "#e80273",  // beigepink-500
};

const accentColor = ACCENT_HEX[accent] || ACCENT_HEX.pink;
const buttonStyle = `background-color: ${accentColor}; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem;`;
const headerStyle = `background-color: ${accentColor}; color: white; padding: 1.5rem;`;
---

<div
  id={id}
  class="max-w-md mx-auto overflow-hidden rounded-xl bg-white shadow-lg"
  data-donation
  data-flow={JSON.stringify(flow)}
>
  <header style={headerStyle}>
    <h3 class="text-xl font-bold">{title}</h3>
    <p class="text-sm opacity-90">{subtitle}</p>
  </header>

  <div class="p-6 space-y-4">
    {flow.map(step => (
      <section class="step hidden" data-step={step}>
        {step === "amount" && (
          <>
            <h4 class="text-center font-semibold mb-4">V√¶lg bel√∏b</h4>
            <div class="flex justify-center gap-3 mb-4">
              {amounts.map(a => (
                <button type="button" class="rounded-lg border px-4 py-2 text-sm">{a} kr</button>
              ))}
            </div>
          </>
        )}
        {step === "info" && (
          <>
            <h4 class="text-center font-semibold mb-4">Information</h4>
            <input class="w-full rounded border p-2 mb-2" placeholder="Fornavn" />
            <input class="w-full rounded border p-2 mb-2" placeholder="Efternavn" />
            <input class="w-full rounded border p-2 mb-4" placeholder="Email" />
          </>
        )}
        {step === "method" && (
          <>
            <h4 class="text-center font-semibold mb-4">Betalingsmetode</h4>
            <label class="block mb-2"><input type="radio" name={id} /> MobilePay</label>
            <label class="block mb-4"><input type="radio" name={id} /> Kort</label>
          </>
        )}
        {step === "payment" && (
          <>
            <h4 class="text-center font-semibold mb-4">Betaling</h4>
            <input class="w-full rounded border p-2 mb-2" placeholder="Kortnummer" />
            <div class="grid grid-cols-3 gap-2 mb-4">
              <input class="rounded border p-2" placeholder="MM/√Ö√Ö" />
              <input class="rounded border p-2" placeholder="CVC" />
              <input class="rounded border p-2" placeholder="Postnr." />
            </div>
          </>
        )}
        {step === "terms" && (
          <>
            <label class="block mb-4"><input type="checkbox" /> Jeg accepterer betingelserne</label>
          </>
        )}
        {step === "thankyou" && (
          <>
            <h4 class="text-center font-semibold mb-2">Tak for st√∏tten üíõ</h4>
            <p class="text-center text-sm">Vi har sendt en kvittering p√• email.</p>
          </>
        )}
        <div class="flex justify-between mt-2">
          <button class="prev">‚Üê Tilbage</button>
          <button style={buttonStyle}>{step === "terms" ? "Don√©r" : "N√¶ste ‚Üí"}</button>
        </div>
      </section>
    ))}
  </div>
</div>

<script type="module">
  document.querySelectorAll("[data-donation]").forEach(card => {
    const flow = JSON.parse(card.dataset.flow);
    const steps = flow.map(s => card.querySelector(`[data-step="${s}"]`));
    let i = 0;

    const show = () => steps.forEach((s, idx) => s.classList.toggle("hidden", idx !== i));

    card.addEventListener("click", e => {
      if (e.target.closest("button") && e.target.textContent.includes("N√¶ste") && i < steps.length - 1) i++;
      if (e.target.closest(".prev") && i > 0) i--;
      show();
    });

    show();
  });
</script>
